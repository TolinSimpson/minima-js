<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MinimaJS - Basic Example</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 2px solid #eee;
    }
    
    .logo {
      font-size: 2.5em;
      font-weight: bold;
      color: #2196F3;
      margin-bottom: 10px;
    }
    
    .subtitle {
      color: #666;
      font-size: 1.1em;
    }
    
    .component {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .component h3 {
      margin-top: 0;
      color: #495057;
    }
    
    button {
      background: #2196F3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    
    button:hover {
      background: #1976D2;
    }
    
    input, textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      margin: 5px 0;
      box-sizing: border-box;
    }
    
    .counter {
      font-size: 2em;
      font-weight: bold;
      color: #2196F3;
      text-align: center;
      margin: 20px 0;
    }
    
    .todo-item {
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin: 5px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .todo-item.completed {
      opacity: 0.6;
      text-decoration: line-through;
    }
    
    .todo-actions button {
      padding: 5px 10px;
      font-size: 12px;
      margin-left: 5px;
    }
    
    .stats {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .demo-section {
      margin: 30px 0;
    }
    
    code {
      background: #f1f3f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Monaco', 'Consolas', monospace;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">MinimaJS</div>
    <div class="subtitle">Ultra-minimalist JavaScript Framework</div>
    <p>Less than 5KB ‚Ä¢ No Dependencies ‚Ä¢ Universal Browser Support</p>
  </div>

  <div id="app">
    <p>Loading MinimaJS framework...</p>
  </div>

  <!-- Load MinimaJS Framework -->
  <script src="../src/minima.js"></script>
  <script src="../src/minima.dev.js"></script>

  <script>
    // =========================================================================
    // COUNTER COMPONENT EXAMPLE
    // =========================================================================
    
    const Counter = MinimaJS.defineComponent(function(props) {
      // Enhanced state with computed properties
      this.state = MinimaJS.createState({
        count: props.initialCount || 0,
        name: props.name || 'Basic Counter'
      }, {
        // Computed properties automatically update when dependencies change
        doubleCount: function(state) {
          return state.count * 2;
        },
        isEven: function(state) {
          return state.count % 2 === 0;
        },
        status: function(state) {
          if (state.count === 0) return 'Zero';
          if (state.count > 0) return 'Positive';
          return 'Negative';
        }
      });
      
      // Component methods (available in templates)
      this.increment = () => {
        this.state.count++;
      };
      
      this.decrement = () => {
        this.state.count--;
      };
      
      this.reset = () => {
        this.state.count = 0;
      };
      
      // Enhanced lifecycle hooks
      this.onInit = function() {
        console.log(`${this.state.name} initialized with count:`, this.state.count);
      };
      
      this.onUpdate = function() {
        console.log(`${this.state.name} updated to:`, this.state.count);
      };
      
      this.onDestroy = function() {
        console.log(`${this.state.name} destroyed`);
      };
      
      // Performance optimization
      this.shouldUpdate = function(newProps, newState) {
        // Only update if count actually changed
        return newState.count !== this.state.count;
      };
      
      // Enhanced template with interpolation and event binding
      return `
        <div class="component">
          <h3>üî¢ {{state.name}} (Enhanced)</h3>
          <div class="counter">{{state.count}}</div>
          <p>Double: <strong>{{state.doubleCount}}</strong> | 
             Type: <strong>{{state.isEven ? 'Even' : 'Odd'}}</strong> | 
             Status: <strong>{{state.status}}</strong></p>
          <button @click="increment">‚ûï Increment</button>
          <button @click="decrement">‚ûñ Decrement</button>
          <button @click="reset">üîÑ Reset</button>
          <p><small>State: count = {{state.count}} (with computed properties)</small></p>
        </div>
      `;
    });

    // =========================================================================
    // TODO LIST COMPONENT EXAMPLE
    // =========================================================================
    
    const TodoList = MinimaJS.defineComponent(function(props) {
      // Enhanced state with computed properties
      this.state = MinimaJS.createState({
        todos: [
          { id: 1, text: 'Learn MinimaJS', completed: false },
          { id: 2, text: 'Build awesome apps', completed: false },
          { id: 3, text: 'Share with the world', completed: false }
        ],
        newTodo: '',
        nextId: 4
      }, {
        // Computed properties
        completedCount: function(state) {
          return state.todos.filter(todo => todo.completed).length;
        },
        totalCount: function(state) {
          return state.todos.length;
        },
        remainingCount: function(state) {
          return state.todos.length - state.todos.filter(todo => todo.completed).length;
        }
      });
      
      // Component methods (available in templates)
      this.addTodo = () => {
        if (this.state.newTodo.trim()) {
          this.state.todos = [
            ...this.state.todos,
            {
              id: this.state.nextId++,
              text: this.state.newTodo.trim(),
              completed: false
            }
          ];
          this.state.newTodo = '';
        }
      };
      
      this.toggleTodo = (id) => {
        this.state.todos = this.state.todos.map(todo =>
          todo.id === id ? { ...todo, completed: !todo.completed } : todo
        );
      };
      
      this.deleteTodo = (id) => {
        this.state.todos = this.state.todos.filter(todo => todo.id !== id);
      };
      
      this.updateNewTodo = (event) => {
        this.state.newTodo = event.target.value;
      };

      // Set up event delegation on init
      this.onInit = function() {
        // Add event listeners using the component's managed addEventListener
        const container = document.querySelector('.component h3').parentElement;
        
        this.addEventListener(container, 'click', (event) => {
          if (event.target.classList.contains('toggle-btn')) {
            const id = parseInt(event.target.dataset.id);
            this.toggleTodo(id);
          } else if (event.target.classList.contains('delete-btn')) {
            const id = parseInt(event.target.dataset.id);
            this.deleteTodo(id);
          }
        });
      };
      
      // Enhanced template with interpolation and event binding
      return `
        <div class="component">
          <h3>üìù Todo List Component (Enhanced)</h3>
          
          <div>
            <input 
              type="text" 
              placeholder="Add a new todo..." 
              value="{{state.newTodo}}"
              onkeyup="if(event.key==='Enter') this.addTodo()"
              @input="updateNewTodo"
            />
            <button @click="addTodo">‚ûï Add Todo</button>
          </div>
          
          <div class="stats">
            üìä <strong>Stats:</strong> 
            {{state.totalCount}} total, 
            {{state.completedCount}} completed, 
            {{state.remainingCount}} remaining
          </div>
          
          <div>
            ${this.state.todos.length > 0 ? this.state.todos.map(todo => `
              <div class="todo-item ${todo.completed ? 'completed' : ''}" key="${todo.id}">
                <span>${todo.text}</span>
                <div class="todo-actions">
                  <button data-id="${todo.id}" class="toggle-btn">
                    ${todo.completed ? '‚Ü©Ô∏è Undo' : '‚úÖ Done'}
                  </button>
                  <button data-id="${todo.id}" class="delete-btn" style="background: #f44336;">
                    üóëÔ∏è Delete
                  </button>
                </div>
              </div>
            `).join('') : '<p><em>No todos yet. Add one above!</em></p>'}
          </div>
        </div>
      `;
    });

    // =========================================================================
    // USER PROFILE COMPONENT WITH GLOBAL STATE
    // =========================================================================
    
    // Create global user store
    const userStore = MinimaJS.store('user', {
      name: 'Demo User',
      email: 'demo@minimajs.com',
      theme: 'light'
    });
    
    const UserProfile = MinimaJS.defineComponent(function(props) {
      // Subscribe to global user state changes
      this.onInit = function() {
        this._unsubscribe = MinimaJS.onGlobalStateChange('user', 'name', (newName) => {
          console.log('User name changed to:', newName);
          // Component will re-render automatically
        });
      };
      
      // Event handlers
      const updateName = (event) => {
        userStore.name = event.target.value;
      };
      
      const updateEmail = (event) => {
        userStore.email = event.target.value;
      };
      
      const toggleTheme = () => {
        userStore.theme = userStore.theme === 'light' ? 'dark' : 'light';
      };
      
      return `
        <div class="component">
          <h3>üë§ User Profile (Global State)</h3>
          
          <div>
            <label>Name:</label>
            <input 
              type="text" 
              value="${userStore.name}"
              oninput="updateName(event)"
            />
          </div>
          
          <div>
            <label>Email:</label>
            <input 
              type="email" 
              value="${userStore.email}"
              oninput="updateEmail(event)"
            />
          </div>
          
          <div>
            <label>Theme: <code>${userStore.theme}</code></label>
            <button onclick="toggleTheme()">
              üé® Switch to ${userStore.theme === 'light' ? 'Dark' : 'Light'} Theme
            </button>
          </div>
          
          <div class="stats">
            üåê <strong>Global State:</strong> This data is shared across all components
          </div>
        </div>
      `;
    });

    // =========================================================================
    // MAIN APP COMPONENT
    // =========================================================================
    
    const App = MinimaJS.defineComponent(function(props) {
      return `
        <div>
          <div class="demo-section">
            <h2>üéØ MinimaJS v1.1 Enhanced Features Demo</h2>
            <p>This example demonstrates the enhanced features of MinimaJS v1.1:</p>
            <ul>
              <li>üß± <strong>Enhanced Components</strong> - With lifecycle hooks and performance optimization</li>
              <li>üîÑ <strong>Computed Properties</strong> - Automatic derived state with dependency tracking</li>
              <li>üé® <strong>Enhanced Templates</strong> - {{}} interpolation and @event binding</li>
              <li>‚ö° <strong>Performance Features</strong> - Memoization, batch updates, shouldUpdate</li>
              <li>üåê <strong>Global state stores</strong> - Share data across components</li>
              <li>üß© <strong>Fragment Support</strong> - Multiple root elements</li>
              <li>üîß <strong>Enhanced Debugging</strong> - Better error messages and suggestions</li>
            </ul>
          </div>

          <div id="todo-demo"></div>
          <div id="user-demo"></div>

          <div class="component">
            <h3>üé≠ Component Memoization Demo</h3>
            <p>These counters demonstrate memoization - identical props are cached for performance:</p>
            <div style="display: flex; gap: 20px;">
              <div style="flex: 1;">
                <h4>Regular Component:</h4>
                <div id="counter1"></div>
              </div>
              <div style="flex: 1;">
                <h4>Memoized Component:</h4>
                <div id="counter2"></div>
              </div>
            </div>
          </div>
          
          <div class="component">
            <h3>üõ†Ô∏è Development Tools</h3>
            <p>Open your browser's developer console and try these commands:</p>
            <ul>
              <li><code>MinimaJS.dev.listComponents()</code> - List all registered components</li>
              <li><code>MinimaJS.dev.getPerformanceStats()</code> - View render performance</li>
              <li><code>MinimaJS.dev.inspectStore('user')</code> - Inspect global stores</li>
            </ul>
            <p><strong>Hot Reload:</strong> Try editing this file and watch it reload automatically!</p>
          </div>
          
          <div class="component">
            <h3>üìö Next Steps</h3>
            <p>Ready to build your own MinimaJS app? Check out:</p>
            <ul>
              <li><a href="todo-app.html">üìù Advanced Todo App</a> - More complex example</li>
              <li><a href="components-demo.html">üß© Component Showcase</a> - All component features</li>
              <li><a href="../src/minima.js">üìñ Source Code</a> - See how it works under the hood</li>
            </ul>
          </div>
        </div>
      `;
    });

    // =========================================================================
    // RENDER APPLICATION
    // =========================================================================
    
    // Wait for DOM to be ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ Starting MinimaJS v1.1 Enhanced Example');
      
      // Render the main app
      MinimaJS.render(App, document.getElementById('app'));
      
      // Demonstrate memoization by rendering the same counter twice
      const counter1Container = document.getElementById('counter1');
      const counter2Container = document.getElementById('counter2');
      
      if (counter1Container && counter2Container) {
        // Regular component render
        const RegularCounter = () => Counter({ initialCount: 10, name: 'Regular' });
        MinimaJS.render(RegularCounter, counter1Container);
        
        // Memoized component render - will be cached for identical props
        const MemoizedCounter = () => MinimaJS.memo(Counter, { initialCount: 10, name: 'Memoized' });
        MinimaJS.render(MemoizedCounter, counter2Container);
        
        console.log('üé≠ Memoization demo: Both counters have identical props');
        console.log('üí° The memoized version will reuse cached renders for better performance');
      }

      // Render other demo components
      const todoContainer = document.getElementById('todo-demo');
      const userContainer = document.getElementById('user-demo');
      
      if (todoContainer) {
        MinimaJS.render(TodoList, todoContainer);
      }
      
      if (userContainer) {
        MinimaJS.render(UserProfile, userContainer);
      }
      
      console.log('‚úÖ App rendered successfully with v1.1 features');
      console.log('üí° Try the dev tools: MinimaJS.dev.listComponents()');
      console.log('üîß New features: computed properties, enhanced templates, lifecycle hooks');
    });
    
    // Global function declarations for inline event handlers
    // In a real app, you'd use proper event delegation or component methods
    window.increment = () => console.log('Global increment called');
    window.decrement = () => console.log('Global decrement called');
    window.reset = () => console.log('Global reset called');
    window.addTodo = () => console.log('Global addTodo called');
    window.toggleTodo = (id) => console.log('Global toggleTodo called with', id);
    window.deleteTodo = (id) => console.log('Global deleteTodo called with', id);
    window.updateNewTodo = (event) => console.log('Global updateNewTodo called');
    window.updateName = (event) => console.log('Global updateName called');
    window.updateEmail = (event) => console.log('Global updateEmail called');
    window.toggleTheme = () => console.log('Global toggleTheme called');
  </script>
</body>
</html>